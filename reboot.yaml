---
- name: Reboot Ubuntu Server
  hosts: 10.0.0.13
  become: yes  # Run tasks with sudo

  tasks:
    - name: Reboot the server
      command: shutdown -r now
      async: 0
      poll: 0
      ignore_errors: true
      register: reboot_result

    - name: Wait for the server to come back
      async_status:
        jid: "{{ reboot_result.ansible_job_id }}"
      register: job_result
      until: job_result.finished
      retries: 30
      delay: 10
